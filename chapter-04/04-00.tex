\chapter{Difference-in-Differences: From Canonical to Staggered}
\label{ch:did}
\index{difference-in-differences|(}

\index{difference-in-differences}Difference-in-differences is the workhorse of causal panel data analysis in marketing. Loyalty programme rollouts, advertising campaign launches, platform expansions, and pricing experiments all generate panel data where treatment is adopted at different times across units. The DiD framework exploits this variation, comparing changes in outcomes for treated units to changes for control units to isolate causal effects. The logic is elegant: if treated and control units would have followed similar trends in the absence of treatment, then the difference in their post-treatment trends identifies the causal effect of treatment.

 The canonical 2Ã—2 DiD design---two groups, two periods, treatment switching on for one group in the second period---provides conceptual clarity and a clean identification argument grounded in parallel trends and corresponds to the block assignment mechanism introduced in Section~\ref{sec:assignment-estimands}. However, most marketing applications feature staggered adoption, where units adopt treatment at different times, and treatment effects that vary across cohorts and evolve dynamically over time. Extending DiD to these settings requires care. Traditional two-way fixed effects regressions can produce misleading estimates when treatment effects are heterogeneous, assigning negative weights to some comparisons and obscuring the true pattern of effects. Modern heterogeneity-robust estimators solve this problem by constructing clean comparisons and aggregating cohort-time effects transparently.

In this chapter, we develop the DiD framework from its canonical form through to modern methods for staggered adoption. We begin with the canonical design, establishing the parallel trends assumption and the potential outcomes framework. We then define estimands for staggered adoption -- cohort-time effects $\text{ATT}(g,t)$ and event-time effects -- and explain the negative weighting problem in two-way fixed effects. Modern estimators from Callaway and Sant'Anna, Sun and Abraham, and others provide solutions, and we show how to implement them, conduct diagnostics, and assess robustness. Throughout, we emphasise practical guidance for marketing applications: how to define estimands that align with business questions, how to diagnose assumption violations, how to choose among competing estimators, and how to report results transparently. Chapter~\ref{ch:event} extends these methods to event-study designs that trace dynamic treatment paths and test for anticipation effects.

\begin{tcolorbox}[title=Notation Guide for Dynamic and Heterogeneous Effects]
\small
 We use the following notation for dynamic and heterogeneous effects. \textbf{ATT(g,t)} denotes the average treatment effect on the treated for cohort $g$ (units that adopt treatment in period $g$) in calendar period $t$. The event-time effect \textbf{$\theta_k$} represents the average treatment effect across all treated cohorts at event time $k$, where $k$ is the number of periods since treatment adoption. We denote pre-treatment leads by $k < 0$ and post-treatment lags by $k \geq 0$, typically normalizing the reference period $k=-1$ to zero. The long-run multiplier \textbf{$\text{LRM}$} is the cumulative effect of a treatment over all post-treatment periods, often calculated as $\sum_{k \ge 0} \theta_k$. Throughout, we consistently use negative signs for pre-treatment periods (leads) and non-negative signs for post-treatment periods (lags).
\end{tcolorbox}